{% load static %}
<script type="text/javascript" src="{% static 'js/displayPanel.js' %}"></script>

<div>
	<div class="maskRef">
		<div class="label label-success">Reference</div>
	{% if reference %}
		<div class="snapshotInfo">{{ reference.session }}</div>
		<div class="snapshot"><img src="{{ reference.image.url }}" style="width:inherit"></div>
	{% else %}
		<div class="snapshotInfo">No Reference</div>
	{% endif %}
	</div>

	<div class="maskStep">
		<div class="label label-success">Step</div>
		
		{% if stepSnapshot %}
		<div class="snapshotInfo">
			{% if stepSnapshot.refSnapshot %}
			<button type="submit" onclick="updatePanel('{% url "pictureView" sessionId testCaseId testStepId %}', 'display', 'makeRef=True')">Make a reference</button>
			<button type="submit" onclick="toggleElement('diff');">Toggle differences</button>
			{% else %}
			This step is a reference
			<button type="submit" onclick="updatePanel('{% url "pictureView" sessionId testCaseId testStepId %}', 'display', 'makeRef=False')">remove this reference</button>
			{% endif %}
		</div>
		<div class="snapshot">
			<canvas id="diff" width="{{ stepSnapshot.image.width }}" height="{{ stepSnapshot.image.height }}" style="z-index:10;width:400px;position:absolute;"></canvas> 
			<img id="stepSnapshot" src="{{ stepSnapshot.image.url }}" style="z-index:1;width:inherit;position:absolute;">
			<div id="canvas" width="{{ stepSnapshot.image.width }}" height="{{ stepSnapshot.image.height }}" style="z-index:10;width:400px;position:absolute;"></div>
		</div>
		<div id="excludeZone"> 
            Exclude zones
            <table class="table table-striped" id="excludeTable">
                <tr>
                    <th width="20px">active</th>
                    <th>position</th>
                </tr>
            </table>
		</div>
		
		{% else %}
		<div class="snapshot">No Snapshot for this step</div>
		{% endif %}
	</div>
</div>

<script>
	console.log("displaying diff")
	setTimeout(function(){
		initDraw(document.getElementById('canvas'), document.getElementById('excludeTable'), 0);
		displayDifference({{ diff }});
	}, 500);
	
</script>

