{% extends "snapshotServer/base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/seleniumRobot_solo.css' %}">
 
 	<script type="text/javascript" src="{% static 'js/seleniumRobot.js' %}"></script>

{% endblock %}

{% block body %}
<div class="row">
	<div class="col-sm-2 " style="background-color:#006266;height: 40px;"></div>
	<div class="col-sm-8 " style="background-color:#006266;color: white; height: 40px; ">Back</div>
	<div  class="col-sm-2 " style="margin-left: -15px;height: 40px;background-color:#006266;" >&nbsp;  </div>
</div>

<div class="row">
	<div  class="col-sm-1"  style="background-color:#33414a;color: white; text-align: center;height: 25px;"></div>
	<div  class="col-sm-10" style="background-color:#33414a; text-align: center;height: 25px;">&nbsp;</div>
	<div  class="col-sm-1"  style="background-color:#33414a;color: white; text-align: center; padding-left:0px;margin-left: -15px;height: 25px;"></div>
</div>

<div id="testResultDetails">
	<!-- Modal for displaying pictures -->
    <div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span
                            aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                </div>
                <div class="modal-body">
                    <img src="" id="imagepreview" style="width: 80%;">
                </div>
            </div>
        </div>
    </div>
	<div class="container-fluid">
		<section class="content">
		  	<div class="row">
		    	<div class="col-xl-12">
		    		<h4> Test Details - {{ currentTest.testCase.name }}</h4>
		    		<table class="table table-bordered table-sm">
                        <tr>
                        	<th>Application type</th>
                        	<td>Browser</td>
                    	</tr>
                    	<tr>
                        	<th>Application</th>
                        	<td>{{ currentTest.session.browser }}</td>
	                    </tr>
	                    <!-- TODO récupérer les autres informations -->
	                    <tr>
	                        <th>Grid node</th>
	                        <td>xxx</td>
	                    </tr>                                                                                                
	                    <tr>
                            <th>Last State</th>
                            <td>xxx</td>
                        </tr>
                    </table>

		      		{% for stepResult, snapshot in object_list.items %}
		      			<div class="box collapsed-box {% if stepResult.result %}success{% else %}failed{% endif %}">
						<div class="box-header with-border">
							<button type="button" class="btn btn-box-tool" data-widget="collapse">
								<i class="fa fa-plus"></i>
							</button>
							<span class="step-title"> {{ stepResult.step.name }}  - {{ stepResult.duration }} secs</span>
						</div>
						<div class="box-body">
							{% include "snapshotServer/step.html" with actions=stepResult.details.actions %}
							<div class="row">
						        {% for snapshot in stepResult.details.snapshots %}
						        	{% if snapshot.displayInReport and snapshot.idImage %}
						        		<div class="message-snapshot col">
							        		<div class="message-snapshot col">
								        		<div class="text-center">
							        			      <a href="#" onclick="$('#imagepreview').attr('src', $('#{{ snapshot.idImage }}').attr('src'));$('#imagemodal').modal('show');">
							        			          <img id="{{ snapshot.idImage }}" src="{% url "file-download" snapshot.idImage %}" style="width: 300px">
							        			      </a>
							        			</div>
											</div>
											{% if snapshot.title %}
												<div class="text-center">:{{ snapshot.title }}</div>
											{% else %}
												<div class="text-center">:</div>
											{% endif %}
											<div class="text-center font-weight-lighter">
											{% if snapshot.url %}<a href='{{ snapshot.url }}' target=url>URL</a>{% endif %}
											{% if snapshot.idHtml %}| <a href='{% url "file-download" snapshot.idHtml %}' target=html>HTML Source</a>{% endif %}
											</div>
										</div>
						        	{% endif %}
						        {% endfor %}
						    </div>
						    
						    <!-- TODO 
						    Ajouter le téléchargement des fichiers
						    Ajouter les HAR
						    Ajouter les images de référence
						    Ajouter les images pour la comparaison
						    -->
						    
						
						    #foreach( $file in $localStep.getFiles() )
						        #set($log = $file.buildLog())
						        <div class="message-snapshot">$log</div>
						    #end
						    #foreach( $har in $localStep.getHarCaptures() )
						        #set($harLog = $har.buildHarLog())
						        <div class="message-har">$harLog</div>
						    #end

							<!--<ul>
										
									<li>openPage with args: (https://www.qwant.com, )</li>
									<ul>
										<li>maximizeWindow on page QwantHomePage </li>
							    			<li>setWindowToRequestedSize on page QwantHomePage </li>
							    			<div class="message-log">Output: Qwant - Le moteur de recherche qui respecte votre vie privée: <a href='https://www.qwant.com/' target=url>Application URL</a> | <a href='htmls/7d31c1a4c09d373f607eabd7c0b0e0df.html' target=html>Application HTML Source</a> | <a href='screenshots/7d31c1a4c09d373f607eabd7c0b0e0df.png' class='lightbox'>Application Snapshot</a></div>
													<li>isElementPresent on TextFieldElement search Text Box, by={By.className: search_bar__form__input} with args: (15, )</li>
							    			<li>isElementPresent on TextFieldElement search Text Box, by={By.className: search_bar__form__input} </li>
					    			</ul>
								</ul>-->
								<div>
									{% if snapshot %}
										<img src={{ snapshot.image.url }} height="300px">
									{% endif %}
								</div>
							</div>
						</div>
		      	
		      		{% endfor %}
		
					<div class="box collapsed-box success">
						<div class="box-header with-border">
							<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-plus"></i></button> Execution logs
						</div>
						<div class="box-body logs">
							<br/>
							{% for line in stacktrace %}
								<div>{{ line }}</div>
							{% endfor %}
							
						</div>
					</div>				
				</div>
			</div>
		</section>
	</div>		
</div>
{% endblock %}
